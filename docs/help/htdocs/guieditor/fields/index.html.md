
ここでは、GUI編集画面で利用できるフィールド定義について説明します。


<!-- autoindex -->

## フィールドカテゴリ

フィールドには、次のカテゴリがあります。

- input
- module
- loop
- if
- echo

## inputフィールド

inputフィールドは、もっとも重要なフィールド種別で、編集可能な入力欄を埋め込みます。type属性によりさまざまな種類の入力欄を使い分けることができます。

下記は実装例です。

```
{&{"input":{"type":"html","name":"fieldname1","label":"HTML入力欄のサンプル","rows":5,"hidden":false}}&}
```

下記の設定値が、ほとんどのinputフィールドで共通で利用できます。

<dl>
	<dt>type</dt>
		<dd>inputフィールドの入力欄の種類を指定します。</dd>
	<dt>name</dt>
		<dd>入力欄の物理名称を付与します。編集画面上には表示されません。この値により、コンテンツデータとフィールド情報とを関連付けるキーとして利用されますので、モジュールごとに重複のないように命名してください。 name 値を変更すると、すでに使用しているモジュールでリンクが切れ、入力した値が適用されなくなることがあるので注意してください。 <code>_ENV</code> は予約語のため、name に使用できません。</dd>
	<dt>rows</dt>
		<dd>生成される入力欄の行数を指定します。</dd>
	<dt>label</dt>
		<dd>編集画面に表示される入力欄の名称を指定します。</dd>
	<dt>hidden</dt>
		<dd>この設定に<code>true</code>を指定すると、入力欄は表示されますが、HTML上には出力されないようになります。ifフィールドやechoフィールドと組み合わせて使用する場合に、<code>true</code>をセットしてください。デフォルトは <code>false</code> です。</dd>
	<dt>description</dt>
		<dd>フィールドの説明をMarkdown形式で記述します。</dd>
	<dt>default</dt>
		<dd>デフォルトの値を設定します。値の形式は、typeごとに異なります。</dd>

</dl>


### html

HTML形式の入力欄を作成します。この入力欄に入力されたテキストは、HTMLコードとしてそのまま埋め込まれます。

### text

プレーンテキスト形式の入力欄を作成します。この入力欄に入力されたテキストは、HTML特殊文字がエンティティ変換され、改行コードは `<br/>` に置き換えられます。

### markdown

Markdown形式の入力欄を作成します。

### multitext

HTML, プレーンテキスト, Markdown形式のいずれかを選択して編集できる入力欄を作成します。

### image

画像の入力欄を作成します。ただし、このフィールドは `<img>`要素は出力しません。 src属性の中身だけを提供することに注意してください。

### table

テーブル要素を作成します。これは、実験中のフィールドです。<br />
Excel形式で作成したファイルをGUI上からアップロードすると、そのファイルの内容をもとにHTMLを自動生成します。


### html\_attr\_text

汎用的な属性値のテキストを入力する欄を作成します。

HTML特殊文字がエンティティ変換される点は textフィールドと同じですが、改行コードはそのまま出力される点が異なります。

### href

リンク先を入力する入力欄を作成します。

### wysiwyg_tinymce (legacy のみ)

TinyMCEライブラリによるWYSIWYG入力欄を作成します。


### wysiwyg_rte (legacy のみ)

wkrteライブラリによるWYSIWYG入力欄を作成します。

### select

selectフィールドは、選択式の入力欄を作成します。

selectフィールドには、特別な設定値 `options` が定義されています。`options` には、プロパティに `value` と `label` を持ったオブジェクトを配列に格納して設定します。

```
<!-- 実装例 -->
<div style="text-align:{&{"input":{"type":"select", "name":"text-align", "label":"テキスト寄せ", "options":[
	{"value":"left", "label":"左寄せ"},
	{"value":"center", "label":"中央寄せ"},
	{"value":"right", "label":"右寄せ"}
]}}&};">inner html.</div>
```


## moduleフィールド

moduleフィールドは、別のモジュールをネスト可能な領域を埋め込みます。

moduleフィールドを配置すると、GUI編集画面上にブルーのバーが現れ、モジュールをドラッグして追加することができるようになります。

```
<!-- 実装例 -->
<div class="unit">
{&{"module":{"name":"main","label":"メインエリア"}}&}
<!-- /.unit --></div>
```

`name` の値により、コンテンツデータとフィールド情報とを関連付けるキーとして利用されますので、モジュールごとに重複のないように命名してください。



## loopフィールド

loopフィールドは、編集者が任意の回数繰り返し記述しても良い領域を定義します。

loopフィールドを配置すると、GUI編集画面上にグリーンのバーが現れ、ダブルクリックで繰り返し領域を追加します。

```
<!-- 実装例 -->
<ul>
{&{"loop":{"name":"thumb_loop", "label":"サムネイルリスト"}}&}
	<li>リスト</li>
{&"endloop"&}
</ul>
```

`name` の値により、コンテンツデータとフィールド情報とを関連付けるキーとして利用されますので、モジュールごとに重複のないように命名してください。

定義領域の終了は、`{&"endloop"&}` で宣言します。


## if フィールド

ifフィールドは、与えた条件が真の場合にのみ、出力される領域を定義します。

条件分岐領域の終了は、`{&"endif"&}` で宣言します。

使用できる条件を説明します。

### cond

条件式を配列で指定します。

condは2次元配列です。1次元目は or 条件、2次元目は and 条件として評価されます。

```
<!-- 実装例 -->
{&{"input":{"type":"html","name":"sample1","label":"サンプル1"}}&}
{&{"input":{"type":"html","name":"sample2","label":"サンプル2"}}&}

{&{"if":{"cond":[
	[
		"is_set:sample1",
		"sample2==123"
	]
]}}&}
<p>この部分は、sample1 に値が入力され、かつ sample2 に 123 を入力した場合のみ出力されます。</p>
{&"endif"&}

{&{"if":{"cond":[
	[
		"sample1==123",
		"sample2!=123"
	]
]}}&}
<p>この部分は、sample1 に 123 が入力され、かつ sample2 に 123 以外の値が入力された場合のみ出力されます。</p>
{&"endif"&}

{&{"if":{"cond":[
	[
		"is_mode:canvas"
	]
]}}&}
<p>この部分は、編集画面でのみ表示されます。最終描画時のみ表示したい場合は、<code>is_mode:finalize</code>と書きます。</p>
{&"endif"&}
```



### is_set

指定した名前のフィールドに値がセットされている場合に、内容を表示します。

```
<!-- 実装例 -->
{&{"input":{"type":"html","name":"sample1","label":"サンプル1"}}&}

{&{"if":{"is_set":"sample1"}}&}
<p>この部分は、sample1 に値を入力した場合のみ出力されます。</p>
{&"endif"&}
```



## echoフィールド

echoフィールドは、別のフィールドで入力された値を出力します。

```
<!-- 実装例 -->
{&{"input":{"type":"html","name":"sample1","label":"サンプル1","hidden":true}}&}

{&{"echo":{"ref":"sample1"}}&}
```

この例は、HTML入力欄 `sample1` の値を、後で出力しています。
HTML入力欄自体は、`"hidden":true` で隠しているので、結果として、入力値は1回だけ出力されます。





