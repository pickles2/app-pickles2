<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>publish - Pickles 2 Desktop Tool</title>

		<meta name="viewport" content="width=device-width" />
		<meta name="keywords" content="" />
		<meta name="description" content="" />

		<!-- jQuery -->
		<script src="../../common/scripts/jquery-1.11.1.min.js" type="text/javascript"></script>

		<!-- jQuery UI -->
		<link rel="stylesheet" href="../../common/jquery-ui/jquery-ui.min.css">
		<script src="../../common/jquery-ui/jquery-ui.min.js"></script>

		<!-- jQuery mobile -->
		<link rel="stylesheet" href="../../common/jquery.mobile/jquery.mobile-1.4.5.min.css" />
		<script src="../../common/jquery.mobile/jquery.mobile-1.4.5.min.js"></script>

		<!-- Bootstrap -->
		<link rel="stylesheet" href="../../common/bootstrap/css/bootstrap.min.css">
		<script src="../../common/bootstrap/js/bootstrap.min.js"></script>

		<!-- normalize & FESS -->
		<link rel="stylesheet" href="../../common/styles/contents.css" type="text/css" />

		<!-- Local Resources -->
		<link rel="stylesheet" href="./index_files/style.css" type="text/css" />

		<script>
			window.px = $.px = window.parent.px;

			function cont_publish(btn){
				$(btn).attr('disabled', 'disabled');
				var pj = px.getCurrentProject();
				$('.cont_console').text('');
				var $msg = $('<div>');
				px.spawnDialog(
					'php',
					[
						pj.get('path') + '/' + pj.get('entry_script') ,
						'/?PX=publish.run'
					] ,
					{
						cd: pj.get('path'),
						title: 'パブリッシュ',
						description: $msg.text('スタティックHTMLをパブリッシュしています。'),
						success: function(data){
							$('.cont_console').text(
								$('.cont_console').text() + data
							);
						} ,
						error: function(data){
							$('.cont_console').text(
								$('.cont_console').text() + data
							);
						} ,
						cmdComplete: function(code){
							$msg.text( 'パブリッシュを完了しました。' );
						} ,
						complete: function(dataFin){
							$(btn).removeAttr('disabled');
							px.message( 'パブリッシュを完了しました。' );
						}
					}
				);
				// pj.execPx2(
				// 	'/?PX=publish.run',
				// 	{
				// 		success: function(data){
				// 			$('.cont_console').text(
				// 				$('.cont_console').text() + data
				// 			);
				// 		} ,
				// 		error: function(data){
				// 			$('.cont_console').text(
				// 				$('.cont_console').text() + data
				// 			);
				// 		} ,
				// 		complete: function(code){
				// 			// $('.cont_console').text(
				// 			// 	$('.cont_console').text() + code
				// 			// );
				// 			$(btn).removeAttr('disabled');
				// 			px.message( 'パブリッシュを完了しました。' );
				// 		}
				// 	}
				// );
			}

			function cont_open_publish_dir(btn){
				$(btn).attr('disabled', 'disabled');
				var pj = px.getCurrentProject();
				window.px.utils.spawn('open',
					[pj.get('path')+'/'+pj.get('home_dir')+'/_sys/ram/publish/'],
					{
						cd: pj.get('path') ,
						complete: function(code){
							$(btn).removeAttr('disabled');
						}
					}
				);
			}

		</script>
	</head>
	<body>
		<div class="container">
			<h1>publish</h1>
		</div>
		<div class="contents">
			<div class="container">
				<div class="row">
					<div class="col-md-8">
						<p><button onclick="cont_publish(this); return false;">パブリッシュする</button></p>
					</div>
					<div class="col-md-4">
						<p><button onclick="cont_open_publish_dir(this); return false;">パブリッシュディレクトリを開く</button></p>
					</div>
				</div>
				<pre class="cont_console" style="max-height:360px;">console:
</pre>

			</div>
		</div>
	</body>
</html>